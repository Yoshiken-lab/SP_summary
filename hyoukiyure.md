表記揺れ対応の運用フロー
📋 表記揺れが発生した場合の対応手順
シナリオ: 未登録学校エラー → 既存学校と表記が異なる
例: 「小山市立小山城北小学校」が未登録エラー

ステップ1: 販売サイトで正式情報を確認
販売サイトにログイン
学校名で検索
以下を確認:
学校ID: 1022
正式な学校名: 小山市立小山城北小学校
ステップ2: 登録スクリプトを実行
python C:\Users\admin\.gemini\add_school_with_id.py 1022 "小山市立小山城北小学校"
出力例:

⚠️  school_id=1022は既に登録されています
    既存の学校名: 小山市立城北小学校
    指定された学校名: 小山市立小山城北小学校
⚠️ 学校名が異なります。本当に上書きしますか? (y/n)
→ 表記揺れを検出!

ステップ3: 報告書Excel内の表記を確認
python C:\Users\admin\.gemini\check_school_variants.py "城北"
結果:

学校別シート: 「小山市立城北小学校」
イベント別シート: 「小山市立城北小学校」
会員率シート: 「小山市立小山城北小学校」
→ 混在を確認

ステップ4: 学校名マッピングに追加
importer_v2.py
を編集:

SCHOOL_NAME_MAPPINGS = {
    ...
    '小山市立城北小学校': '小山市立小山城北小学校',  # 追加
}
ステップ5: schools_masterを正式名称に更新
python C:\Users\admin\.gemini\add_school_with_id.py 1022 "小山市立小山城北小学校"
> y  # 上書き確認
これで:

schools_master内の学校名が正式名称に更新
school_id=1022は変更なし
ステップ6: 担当者マスタを更新(推奨)
担当者マスタ.xlsxを開いて:

「小山市立城北小学校」を検索
「小山市立小山城北小学校」に修正
保存
次回の月次集計で自動反映

ステップ7: テスト実行
python C:\Users\admin\.gemini\test_import_v2.py
期待される結果:

✅ 全てのデータが成功
「小山市立城北小学校」→自動で「小山市立小山城北小学校」に変換
全てschool_id=1022に統合
🎯 今後の運用
表記揺れ発生時の判断基準
販売サイトの正式名称を確認
正式名称をschools_masterに登録
旧表記は学校名マッピングで吸収
メンテナンス
月次集計前:

担当者マスタを販売サイトの最新情報に更新
報告書インポート時:

エラーが出たら上記フローで対応
学校名マッピングは徐々に蓄積される
💡 Tips
よくある表記揺れパターン:

「市立」「区立」の有無
地名の省略(「小山」の有無など)
漢字とひらがな
スペースの有無
予防策:

担当者マスタは販売サイトと定期的に同期
新規学校追加時は正式名称を確認
